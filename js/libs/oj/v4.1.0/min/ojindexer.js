/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","hammerjs","promise","ojs/ojjquery-hammer","ojs/ojcomponentcore"],function(a,g,c){a.Oq=function(){};o_("IndexerModel",a.Oq,a);a.Oq.SECTION_OTHERS={id:"__others__",label:a.za.R("oj-ojIndexer.indexerOthers")};o_("IndexerModel.SECTION_OTHERS",a.Oq.SECTION_OTHERS,a);a.zl=function(a){this.wa=a;this.Init()};o_("ListViewIndexerModel",a.zl,a);a.f.va(a.zl,a.xl,"oj.ListViewIndexerModel");a.zl.prototype.getIndexableSections=function(){return this.wa.fa.R("indexerCharacters").split("|")};
a.f.j("ListViewIndexerModel.prototype.getIndexableSections",{getIndexableSections:a.zl.prototype.getIndexableSections});a.zl.prototype.getMissingSections=function(){null==this.oya&&(this.oya=this.INa());return this.oya};a.f.j("ListViewIndexerModel.prototype.getMissingSections",{getMissingSections:a.zl.prototype.getMissingSections});a.zl.prototype.INa=function(){var a=[],c,e,f,h,k,l;c=this.wa.HJ();if(null!=c)for(e=this.getIndexableSections(),f=0;f<e.length;f++)h=e[f],k=!1,c.each(function(){l=g(this).text();
if(0<l.length&&l.charAt(0)==h)return k=!0,!1}),k||a.push(h);return a};a.zl.prototype.setSection=function(b){return b==a.Oq.SECTION_OTHERS?this.WXa():this.cYa(b)};a.f.j("ListViewIndexerModel.prototype.setSection",{setSection:a.zl.prototype.setSection});a.zl.prototype.WXa=function(){var b,c=this,e,f,h,k,l;b=this.getIndexableSections();return new Promise(function(m){e=null;f=c.wa.HJ();null!=f&&f.each(function(){h=g(this).text();for(k=0;k<b.length;k++)if(l=b[k],0==h.indexOf(l))return!0;e=this;return!1});
e?(c.wa.D6(e),m(a.Oq.SECTION_OTHERS)):m(null)})};a.zl.prototype.cYa=function(a){var c,e,f=this,g=null,k;c=this.getIndexableSections();e=c.indexOf(a);return new Promise(function(l){if(-1==e)l(null);else{for(;e<c.length;){a=c[e];k=f.bMa(a);if(null!=k){f.wa.D6(k);g=a;break}e++}l(g)}})};a.zl.prototype.bMa=function(a){var c,e,f;e=this.wa.HJ();null!=e&&e.each(function(){f=g(this).text();if(0==f.indexOf(a))return c=this,!1});return c};(function(){a.hb("oj.ojIndexer",g.oj.baseComponent,{defaultElement:"\x3cul\x3e",
version:"1.2",widgetEventPrefix:"oj",options:{data:null},qc:function(){this._super();this.qb()},Kf:function(){this._super();this.aia();this.TE();this.XJa()},_destroy:function(){this._super();this.pF();this.element.removeClass("oj-component-initnode");a.T.unwrap(this.element,this.Xt())},_setOption:function(a,c){this._superApply(arguments);"data"==a&&this.refresh()},tp:function(){this._super();var a=this.Xt()[0];this.Vp(a);this.CVa(a)},sp:function(){this._super();var a=this.Xt()[0];this.vn(a);this.xZa(a);
this.fm&&(this.fm(null),this.fm=null)},widget:function(){return this.Xt()},refresh:function(){this._super();this.element.empty();this.aia();this.TE();this.Zx=null},getNodeBySubId:function(a){var c,e,f,h,k;if(null==a)return this.element?this.element[0]:null;if("oj-indexer-section"===a.subId)for(a=a.section,c=this.element.children("li"),e=0;e<c.length;e++){h=c.get(e);f=g(h).data("data-range");if(f==a)return h;k=g(h).data("data-includes");if(null!=k)for(f=0;f<k.length;f++)if(k[f]==a)return h}return null},
getSubIdByNode:function(a){return null!=a&&(a=g(a).data("data-range"),null!=a)?{subId:"oj-indexer-section",section:a}:null},TE:function(){this.element.attr("role","slider").attr("aria-orientation","vertical").attr("aria-describedby",this.element.prop("id")+":desc").attr("aria-valuemin",0).attr("aria-valuemax",Math.max(0,this.element.children().length-1))},pF:function(){this.element.removeAttr("role").removeAttr("aria-orientation").removeAttr("aria-describedby").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuetext")},
XJa:function(){var b,c;b=a.T.ke()?"ariaTouchInstructionText":"ariaKeyboardInstructionText";c=g(document.createElement("div"));c.prop("id",this.element.prop("id")+":desc");c.addClass("oj-helper-hidden-accessible").text(this.R(b));this.Xt().append(c)},Xt:function(){null==this.ZM&&(this.ZM=this.UJa());return this.ZM},UJa:function(){var a;this.Fc?a=g(this.Fc):(a=g(document.createElement("div")),this.element.parent()[0].replaceChild(a[0],this.element[0]));a.addClass("oj-indexer oj-component");a.prepend(this.element);
return a},aia:function(){var a,c,e,f,g,k,l;a=this.Vka();if(null!=a){c=this.element;e=a.getIndexableSections();a.getMissingSections&&(f=a.getMissingSections());a=this.R("indexerOthers");g=this.widget().outerHeight();k=this.EQ(e[0],f);c.append(k);k=k.outerHeight();g=Math.floor(g/k);this.Xt().removeClass("oj-indexer-abbr");g=Math.floor((e.length+1)/g)+1;1<g&&this.Xt().addClass("oj-indexer-abbr");for(k=1+g;k<e.length;k=k+g+1)1<g?(l=this.nKa(e,k-g,k-1),c.append(l)):k--,l=e[k],l=this.EQ(l,f),c.append(l);
e=this.EQ(e[e.length-1],f);c.append(e);e=this.EQ(a);e.attr("data-others","true");c.append(e)}},EQ:function(a,c){var e,f;e=a.label?a.label:a;f=g(document.createElement("li"));f.data("data-range",a).text(e);null!=c&&-1<c.indexOf(a)&&f.addClass("oj-disabled");return f},nKa:function(a,c,e){var f,h=[];f=g(document.createElement("li"));for(f.addClass("oj-indexer-ellipsis").data("data-range",a[c+Math.round((e-c)/2)]);c<=e;c++)h.push(a[c]);f.data("data-includes",h);return f},qb:function(){var a=this;this.element.uniqueId().addClass("oj-component-initnode").attr("tabIndex",
0);this._on(this.element,{click:function(c){a.O3(c)},keydown:function(c){a.Hr(c)},focus:function(c){a.jS(c)},blur:function(c){a.WOa(c)}});this._focusable({applyHighlight:!0,setupHandlers:function(c,e){a.Oj=c;a.bj=e}})},O3:function(a){0===a.button&&(a=g(a.target),this.L6(a))},jS:function(){this.Xt().addClass("oj-focus-ancestor");null==this.Zx?this.rn(this.element.children("li").first()):this.rn(this.Zx)},WOa:function(){this.Xt().removeClass("oj-focus-ancestor")},Hr:function(a){var c,e=!1;switch(a.keyCode){case 38:c=
this.Zx.prev();break;case 40:c=this.Zx.next();break;case 13:this.L6(this.Zx),e=!0}null!=c&&0<c.length&&(e=!0,this.rn(c));e&&a.preventDefault()},rn:function(a){null!=this.Zx&&this.bj(this.Zx);this.Oj(a);this.DZa(a);this.Zx=a},Vka:function(){var a=this.option("data");if(null!=a&&(void 0==a.setSection||void 0==a.getIndexableSections))throw"Invalid IndexerModel";return a},L6:function(b){var c=b.data("data-range");b.attr("data-others")&&(c=a.Oq.SECTION_OTHERS);this.O6(c)},O6:function(b){var c=this,e;this.fm=
a.Context.getContext(this.element[0]).Rc().Vc({description:"setCurrentSection"});this.Vka().setSection(b).then(function(a){null!=a&&(e=c.fh(a),null!=e&&c.rn(e));c.fm(null);c.fm=null},function(){c.fm(null);c.fm=null})},DZa:function(b){var c,e;e="";c=b.data("data-includes");null!=c?0<c.length&&(e=c[0].label?c[0].label:c[0],c=c[c.length-1].label?c[c.length-1].label:c[c.length-1],e=this.R("ariaInBetweenText",{first:e,second:c})):(c=b.data("data-range"),e=c===a.Oq.SECTION_OTHERS?this.R("ariaOthersLabel"):
c);b.hasClass("oj-disabled")&&(e=e+". "+this.R("ariaDisabledLabel"));this.element.attr("aria-valuetext",e);this.element.attr("aria-valuenow",b.index())},fh:function(a){var c,e,f,h,k;c=this.element.children();for(e=0;e<c.length;e++)if(f=c.get(e),h=g(f).data("data-range"),k=g(f).data("data-includes"),null!=h&&h==a||null!=k&&-1<k.indexOf(a))return g(f);return null},vn:function(b){b&&this.ti&&a.T.vm(b,this.ti)},Vp:function(b){b&&(null==this.ti&&(this.ti=this.Jh.bind(this)),a.T.em(b,this.ti))},xZa:function(a){this.H9&&
(this.H9.off("panstart panmove panend"),g(a).Tg("destroy"));this.H9=null},CVa:function(a){var d=this,e,f,h,k,l,m,p,t,s,n,q,r;e={recognizers:[[c.Pan,{direction:c.DIRECTION_VERTICAL}]]};this.H9=g(a).Tg(e).on("panstart",function(a){f=a.gesture.target;h=d.element[0].getBoundingClientRect().left+5;k=f.getBoundingClientRect().top;d.L6(g(f));l=f;m=g(f).data("data-range");p=k}).on("panmove",function(a){t=p;p=k+a.gesture.deltaY;f=document.elementFromPoint(h,p);null!=f&&(s=p-t,l==f?(n=g(f).data("data-includes"),
null!=n&&(q=n.indexOf(m),r=null,0<s&&q<n.length-1?r=n[q+1]:0>s&&0<q&&(r=n[q-1]),null!=r&&(m=r,d.O6(r)))):g(f).data("data-range")&&(n=g(f).data("data-includes"),r=null,null!=n&&(0<s&&f==l.nextElementSibling?r=n[0]:0>s&&f==l.previousElementSibling&&(r=n[n.length-1])),null==r&&(r=g(f).data("data-range")),l=f,m=r,d.O6(m)))}).on("panend",function(){r=p=m=l=null})},Jh:function(a,c){0<a&&0<c&&this.refresh()}})})();a.J.Ua("oj-indexer","baseComponent",{properties:{data:{}},extension:{Dj:"ul",Xa:"ojIndexer"}});
a.J.register("oj-indexer",{metadata:a.J.getMetadata("oj-indexer")})});