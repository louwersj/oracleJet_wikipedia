/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojeventtarget","ojs/ojdataprovider"],function(a){var g=function(){function c(a){this.ue=a;this.Wi="key";this.Oc="keys";this.ZY="afterKeys";this.TC="direction";this.bI="startIndex";this.PC="attribute";this.CFa="silent";this.EP="sort";this.nf="sortCriteria";this.SZ="pageSize";this.hc="data";this.vf="metadata";this.Sv="indexes";this.ei="offset";this.d_="refresh";this.hi="size";this.Gj="value";this.Pm="done";this.Qm="fetchParameters";this.FH="containsParameters";this.Xm=
"results";this.YY="add";this.e_="remove";this.D_="update";this.jC=function(){return function(a,b){this.lc=a;this.zp=b;this[Symbol.asyncIterator]=function(){return this.zp}}}();this.kC=function(){function a(b,c,d){this.lc=b;this.PK=c;this.RK=d}a.prototype.next=function(){return this.PK(this.RK)};return a}();this.xv=function(){return function(a,b,c){this.lc=a;this.value=b;this.done=c;this[a.Gj]=b;this[a.Pm]=c}}();this.sC=function(){return function(a,b,c){this.lc=a;this.fetchParameters=b;this.results=
c;this[a.Qm]=b;this[a.Xm]=c}}();this.XG=function(){return function(a,b,c){this.lc=a;this.containsParameters=b;this.results=c;this[a.FH]=b;this[a.Xm]=c}}();this.Bv=function(){return function(a,b,c,h){this.lc=a;this.fetchParameters=b;this.data=c;this.metadata=h;this[a.Qm]=b;this[a.hc]=c;this[a.vf]=h}}();this.ct=function(){return function(a,b,c){this.lc=a;this.metadata=b;this.data=c;this[a.vf]=b;this[a.hc]=c}}();this.Hk=function(){return function(a,b){this.lc=a;this.key=b;this[a.Wi]=b}}();this.fY=function(){return function(a,
b,c,h){this.lc=a;this.fetchParameters=b;this.results=c;this.done=h;this[a.Qm]=b;this[a.Xm]=c;this[a.Pm]=h}}();this.tC=function(){return function(a,b,c){this.lc=a;this.size=b;this.sortCriteria=c;this[a.hi]=b;this[a.nf]=c}}();this.gCa=function(){return function(a,b,c){this.lc=a;this.Aa=b;this.direction=c;this[a.PC]=b;this[a.TC]=c}}();this.yC=function(){return function(a,b,c,h){this.lc=a;this.add=b;this.remove=c;this.update=h;this[a.YY]=b;this[a.e_]=c;this[a.D_]=h}}();this.uO=function(){return function(a,
b,c,h,k){this.lc=a;this.keys=b;this.metadata=c;this.data=h;this.indexes=k;this[a.Oc]=b;this[a.vf]=c;this[a.hc]=h;this[a.Sv]=k}}();this.yY=function(){return function(a,b,c,h,k,g){this.lc=a;this.keys=b;this.metadata=h;this.data=k;this.indexes=g;this[a.Oc]=b;this[a.ZY]=c;this[a.vf]=h;this[a.hc]=k;this[a.Sv]=g}}();this.fHa(a);this[this.ei]=0}c.prototype.containsKeys=function(a){var c=this,e=[];a[this.Oc].forEach(function(a){e.push(c.ue.get(a))});return Promise.all(e).then(function(e){var h=new Set;e.map(function(a){h.add(a[c.Wi])});
return Promise.resolve(new c.XG(c,a,h))})};c.prototype.fetchByKeys=function(a){var c=this,e=[];a[this.Oc].forEach(function(a){e.push(c.ue.get(a))});return Promise.all(e).then(function(e){var h=new Map;e.map(function(a){var b=a[c.Wi];a=a[c.hc];h.set(b,new c.ct(c,new c.Hk(c,b),a))});return Promise.resolve(new c.sC(c,a,h))})};c.prototype.fetchByOffset=function(a){var c=this,e=null!=a?0<a[this.ei]?a[this.ei]:0:0,f=new this.tC(this,null!=a?a[this.hi]:-1,null!=a?a[this.nf]:null),f=this.Gka(f,e),e=f[this.Gj],
f=f[this.Pm],h=e[this.hc],k=e[this.vf].map(function(a){return a[c.Wi]}),e=h.map(function(a,b){return new c.ct(c,a,k[b])});return Promise.resolve(new this.fY(this,a,e,f))};c.prototype.fetchFirst=function(a){this.iu()||(this.oa=0);return new this.jC(this,new this.kC(this,this.Gka(a),a))};c.prototype.getCapability=function(a){return a==this.EP&&"full"==this.ue.getCapability(a)?Promise.resolve({V_a:"sort",attributes:"multiple",type:"js"}):Promise.resolve(null)};c.prototype.getTotalSize=function(){return Promise.resolve(this.ue.totalSize())};
c.prototype.getPage=function(){return this.iu()?this.ue.getPage():-1};c.prototype.setPage=function(a,c){return this.iu()?this.ue.setPage(a,c):Promise.reject(null)};c.prototype.getStartItemIndex=function(){return this.iu()?this.ue.getStartItemIndex():-1};c.prototype.getEndItemIndex=function(){return this.iu()?this.ue.getEndItemIndex():-1};c.prototype.getPageCount=function(){return this.iu()?this.ue.getPageCount():-1};c.prototype.totalSize=function(){return this.iu()?this.ue.totalSize():-1};c.prototype.totalSizeConfidence=
function(){return this.iu()?this.ue.totalSizeConfidence():null};c.prototype.Gka=function(a,c){var e=this;if(null!=a&&null!=a[this.nf]){var f=a[this.nf][0][this.PC],h=a[this.nf][0][this.TC];this.kna=!0;return function(a,b){return function(f){var h={};h[e.Wi]=a;h[e.TC]=b;return e.ue.sort(h).then(function(){e.kna=!1;e.oa=null;return e.Ula(c)(f)})}}(f,h)}return this.Ula(c)};c.prototype.Ula=function(a){var c=this;return function(e){var f={};a=0<a?a:0;null!=c.oa&&(f[c.bI]=c.oa+a);f[c.SZ]=null!=e&&0<e[c.hi]?
e[c.hi]:null;c.iu()||(f[c.CFa]=!0);if(null!=c.ue[c.nf]&&null==e[c.nf]){e[c.nf]=[];var h=new c.gCa(c,c.ue[c.nf][c.Wi],c.ue[c.nf][c.TC]);e[c.nf].push(h)}c.fu=!0;return new Promise(function(a,b){c.jo=a;c.Eja=b;c.V1=e;c.lx||c.ue.fetch(f).then(function(b){if(null!=b){c.fu=!1;var h=null;null!=b[c.Oc]&&(h=b[c.Oc].map(function(a){return new c.Hk(c,a)}));null==c.oa&&(c.oa=0);var g=!1;c.oa+=b[c.hc].length;"actual"==c.ue.totalSizeConfidence()&&0<c.ue.totalSize()&&c.oa>=c.ue.totalSize()?g=!0:0<f[c.SZ]&&b[c.hc].length<
f[c.SZ]?g=!0:0==b[c.hc].length&&(g=!0);c.jo=null;c.V1=null;a(new c.xv(c,new c.Bv(c,e,b[c.hc],h),g))}},function(a){b(a)})})}};c.prototype.fHa=function(b){var c=this;b.on("sync",function(b){c.oa=null;0<b[c.bI]&&(c.oa=b[c.bI],c[c.ei]=c.oa);if(c.jo&&null!=b[c.Oc]){c.fu=!1;var f=b[c.Oc].map(function(a){return new c.Hk(c,a)}),h=!1;"actual"==c.ue.totalSizeConfidence()&&0<c.ue.totalSize()&&c.oa>=c.ue.totalSize()&&(h=!0);c.jo(new c.xv(c,new c.Bv(c,c.V1,b[c.hc],f),h));c.jo=null;c.V1=null}else c.lx||c.dispatchEvent(new a.pC);
c.lx=!1});b.on("add",function(b){var f=b[c.Oc].map(function(a){return new c.Hk(c,a)}),h=new Set;b[c.Oc].map(function(a){h.add(a)});b=new c.yY(c,h,null,f,b[c.hc],b[c.Sv]);b=new c.yC(c,b,null,null);c.dispatchEvent(new a.kH(b))});b.on("remove",function(b){var f=b[c.Oc].map(function(a){return new c.Hk(c,a)}),h=new Set;b[c.Oc].map(function(a){h.add(a)});b=new c.uO(c,h,f,b[c.hc],b[c.Sv]);b=new c.yC(c,null,b,null);c.dispatchEvent(new a.kH(b))});b.on("reset",function(){c.lx||(c.oa=0,c.dispatchEvent(new a.pC))});
b.on(this.EP,function(){c.kna||(c.oa=null,c.dispatchEvent(new a.pC))});b.on("change",function(b){var f=b[c.Oc].map(function(a){return new c.Hk(c,a)}),h=new Set;b[c.Oc].map(function(a){h.add(a)});b=new c.uO(c,h,f,b[c.hc],b[c.Sv]);b=new c.yC(c,null,null,b);c.dispatchEvent(new a.kH(b))});b.on(this.d_,function(b){c.fu||c.lx||(c.oa=null!=b[c.ei]?b[c.ei]:null,c.dispatchEvent(new a.pC));c.lx=!1});b.on("request",function(b){"undefined"!==typeof a.U&&b instanceof a.U||c.fu||(0<b[c.bI]&&0==c.getStartItemIndex()&&
(c.oa=b[c.bI]),c.lx=!0,c.dispatchEvent(new a.pC))});b.on("error",function(a){c.Eja&&c.Eja(a);c.fu=!1;c.lx=!1});b.on("page",function(b){c.fu=!1;c.lx=!1;var f={};f.detail=b;c.dispatchEvent(new a.jY(a.bi.ga.PAGE,f))})};c.prototype.iu=function(){return null!=this.ue.getStartItemIndex?!0:!1};return c}();a.dY.t8(g);a.TableDataSourceAdapter=g;a.KC=g;a.f.j("TableDataSourceAdapter.prototype.containsKeys",{containsKeys:g.prototype.containsKeys});a.f.j("TableDataSourceAdapter.prototype.fetchByKeys",{fetchByKeys:g.prototype.fetchByKeys});
a.f.j("TableDataSourceAdapter.prototype.fetchFirst",{fetchFirst:g.prototype.fetchFirst});a.f.j("TableDataSourceAdapter.prototype.getCapability",{getCapability:g.prototype.getCapability});a.f.j("TableDataSourceAdapter.prototype.getTotalSize",{getTotalSize:g.prototype.getTotalSize})});