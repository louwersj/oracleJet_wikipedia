/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojeventtarget","ojs/ojdataprovider"],function(a){var g=function(){function c(a,c){this.ms=a;this.options=c;this.Wi="key";this.Oc="keys";this.hc="data";this.EP="sort";this.nf="sortCriteria";this.vf="metadata";this.hP="from";this.ei="offset";this.d_="refresh";this.yEa="mutate";this.hi="size";this.Qm="fetchParameters";this.Gj="value";this.Pm="done";this.Pv="dataMapping";this.kEa="mapFields";this.$Fa=this.lEa="mapSortCriteria";this.Xm="results";
this.FH="containsParameters";this.WCa=25;this.wda="containsKeys";this.Rda="fetchByKeys";this.wDa="fetchByOffset";this.Sda="fetchFirst";this.$ca="addEventListener";this.jC=function(){return function(a,b){this.lc=a;this.zp=b;this[Symbol.asyncIterator]=function(){return this.zp}}}();this.kC=function(){function a(b,c,d){this.lc=b;this.PK=c;this.RK=d}a.prototype.next=function(){var a=this.PK(this.RK);return Promise.resolve(a)};return a}();this.xv=function(){return function(a,b,c){this.lc=a;this.value=
b;this.done=c;this[a.Gj]=b;this[a.Pm]=c}}();this.Bv=function(){return function(a,b,c,d){this.lc=a;this.fetchParameters=b;this.data=c;this.metadata=d;this[a.Qm]=b;this[a.hc]=c;this[a.vf]=d}}();this.ct=function(){return function(a,b,c){this.lc=a;this.metadata=b;this.data=c;this[a.vf]=b;this[a.hc]=c}}();this.Hk=function(){return function(a,b){this.lc=a;this.key=b;this[a.Wi]=b}}();this.tC=function(){return function(a,b,c){this.lc=a;this.size=b;this.sortCriteria=c;this[a.hi]=b;this[a.nf]=c}}();this.Bba=
function(){return function(a,b,c,d){this.lc=a;this.offset=b;this.size=c;this.sortCriteria=d;this[a.hi]=c;this[a.nf]=d;this[a.ei]=b}}();this.sC=function(){return function(a,b,c){this.lc=a;this.fetchParameters=b;this.results=c;this[a.Qm]=b;this[a.Xm]=c}}();this.XG=function(){return function(a,b,c){this.lc=a;this.containsParameters=b;this.results=c;this[a.FH]=b;this[a.Xm]=c}}();this[this.hP]=null==this.options?null:this.options[this.hP];this[this.ei]=null==this.options?0:0<this.options[this.ei]?this.options[this.ei]:
0;this[this.nf]=null==this.options?null:this.options[this.nf];this[this.Pv]=null==this.options?null:this.options[this.Pv];this.JGa(a);this.Kj={}}c.prototype.containsKeys=function(a){var c=this;return this.ms[c.wda]?this.ms[c.wda](a):this.fetchByKeys(a).then(function(e){var f=new Set;a[c.Oc].forEach(function(a){null!=e[c.Xm].get(a)&&f.add(a)});return Promise.resolve(new c.XG(c,a,f))})};c.prototype.fetchByKeys=function(a){var c=this;if(this.ms[c.Rda])return this.ms[c.Rda](a).then(function(e){e=e[c.Xm];
var f=new Map;e.forEach(function(a,b){var e=c.V2([a]);f.set(b,e[0])});return new c.sC(c,a,f)});var e={};e[this.hi]=this.WCa;var f=new Map,e=this.ms[c.Sda](e)[Symbol.asyncIterator]();return this.Dja(a,e,f).then(function(e){var f=new Map;e.forEach(function(a,b){var e=c.V2([a]);f.set(b,e[0])});return new c.sC(c,a,f)})};c.prototype.fetchFirst=function(b){this.Kj[this.hc]=[];this.Kj[this.Oc]=[];this.oa=0;var c=null!=b?b[this.hi]:null,e=null!=b?b[this.nf]:null;null==e&&(e=this[this.nf]);var f=this.DNa(e),
g=this;if(null==g[this.hP]&&0<g[this.ei]&&a.Iy.D3a(g.ms)){var k=g[this.ei];return new this.jC(this,new this.kC(this,function(){var a=new g.Bba(g,k,c,f);return g.ms[g.wDa](a).then(function(a){var b=a.results,e=b.map(function(a){return a[g.hc]});b.map(function(a){return a[g.vf]});b=b.map(function(a){return a[g.vf][g.Wi]});k+=b.length;e=g.FR(b,e);g.nQ(e[g.hc],e[g.Oc]);g.Gz=a[g.Pm];a=a[g.Qm];a=g.ima(null!=a?a[g.nf]:null);a=new g.Bba(g,g[g.ei],c,a);return Promise.resolve(new g.xv(g,new g.Bv(g,a,e[g.hc],
e[g.vf]),g.Gz))})}))}e=new this.tC(this,c,f);this.n0=this.ms[g.Sda](e)[Symbol.asyncIterator]();return new this.jC(this,new this.kC(this,function(){return g.n0.next().then(function(a){var c=a[g.Gj][g.hc],d=a[g.Gj][g.vf],e=d.map(function(a){return a[g.Wi]});c.map(function(a,b){return new g.ct(g,d[b],c[b])});e=g.FR(e,c);g.nQ(e[g.hc],e[g.Oc]);g.Gz=a[g.Pm];e=null!=b?b[g.hi]:null;a=a[g.Gj][g.Qm];a=g.ima(null!=a?a[g.nf]:null);var f=new g.tC(g,e,a);return g.Fja(g[g.hP]).then(function(){return g.Gja(f,g[g.ei]+
g.oa,c.length)})})},b))};c.prototype.getCapability=function(a){return this.ms.getCapability(a)};c.prototype.getTotalSize=function(){return this.ms.getTotalSize()};c.prototype.Dja=function(a,c,e){var f=this;return c.next().then(function(g){g=g[f.Gj];var k=g[f.hc],l=g[f.vf],m=l.map(function(a){return a[f.Wi]}),p=!0;a[f.Oc].forEach(function(a){e.has(a)||m.map(function(b,c){b==a&&e.set(b,new f.ct(f,l[c],k[c]))});e.has(a)||(p=!1)});return p?e:f.Dja(a,c,e)})};c.prototype.Fja=function(a){var c=this;if(null!=
a){var e=this.Kj[this.Oc].filter(function(c){if(a==c)return!0});if(0<e.length)e=this.Kj[this.Oc].indexOf(e[0]),this.Kj[this.Oc]=this.Kj[this.Oc].slice(e,this.Kj[this.Oc].length),this.Kj[this.hc]=this.Kj[this.hc].slice(e,this.Kj[this.hc].length);else if(c.Gz)this.Kj[this.hc]=[],this.Kj[this.Oc]=[];else return c.n0.next().then(function(a){var b=a[c.Gj][c.hc],e=a[c.Gj][c.vf].map(function(a){return a[c.Wi]}),b=c.FR(e,b);c.nQ(b[c.hc],b[c.Oc]);c.Gz=a[c.Pm];return c.Fja(b[c.Oc])})}return Promise.resolve(null)};
c.prototype.Gja=function(a,c,e){var f=this;e=null!=a?0<a[this.hi]?a[this.hi]:e:e;c=0<c?c:0;var g=this.Kj[this.Oc].slice(c,c+e),k=this.Kj[this.hc].slice(c,c+e),g=g.map(function(a){return new f.Hk(f,a)});if(k.length<e)return f.Gz?(f.oa+=k.length,Promise.resolve(new f.xv(f,new f.Bv(f,a,k,g),!0))):f.n0.next().then(function(a){var b=a[f.Gj][f.hc],e=a[f.Gj][f.vf].map(function(a){return a[f.Wi]}),e=f.FR(e,b);f.nQ(e[f.hc],e[f.Oc]);f.Gz=a[f.Pm];return f.Gja(a[f.Gj][f.Qm],c,b.length)});f.oa+=k.length;return Promise.resolve(new f.xv(f,
new f.Bv(f,a,k,g),f.Gz))};c.prototype.nQ=function(a,c){var e=this;a.map(function(a){e.Kj[e.hc].push(a)});c.map(function(a){e.Kj[e.Oc].push(a)})};c.prototype.V2=function(a){var c=this;if(null!=this[this.Pv]){var e=this[this.Pv][this.kEa];if(null!=e&&null!=a&&0<a.length){var f=[];return f=a.map(function(a){return e.bind(c)(a)})}}return a};c.prototype.FR=function(a,c){var e=this,f=c.map(function(f,g){return new e.ct(e,new e.Hk(e,a[g]),c[g])}),g=this.V2(f),f=g.map(function(a){return a[e.hc]}),k=g.map(function(a){return a[e.vf][e.Wi]}),
g=g.map(function(a){return a[e.vf]}),l={};l[this.hc]=f;l[this.Oc]=k;l[this.vf]=g;return l};c.prototype.DNa=function(a){if(null!=this[this.Pv]){var c=this[this.Pv][this.lEa];if(null!=c&&null!=a&&0<a.length)return c(a)}return a};c.prototype.ima=function(a){if(null!=this[this.Pv]){var c=this[this.Pv][this.$Fa];if(null!=c&&null!=a&&0<a.length)return c(a)}return a};c.prototype.JGa=function(a){var c=this;a[c.$ca](this.d_,function(a){c.dispatchEvent(a)});a[c.$ca](this.yEa,function(a){c.dispatchEvent(a)})};
return c}();a.ListDataProviderView=g;a.eca=g;a.dY.t8(g);a.f.j("ListDataProviderView.prototype.fetchFirst",{fetchFirst:g.prototype.fetchFirst});a.f.j("ListDataProviderView.prototype.getCapability",{getCapability:g.prototype.getCapability});a.f.j("ListDataProviderView.prototype.fetchByKeys",{fetchByKeys:g.prototype.fetchByKeys});a.f.j("ListDataProviderView.prototype.containsKeys",{containsKeys:g.prototype.containsKeys})});