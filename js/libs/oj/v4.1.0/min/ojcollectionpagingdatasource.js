/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","knockout","ojs/ojdatasource-common","ojs/ojmodel","ojs/ojknockout-model"],function(a,g,c){a.Kc=function(a){this.yb=a;this.current=0;this.Init();this.fk=[];this.U6(10)};o_("CollectionPagingDataSource",a.Kc,a);a.f.va(a.Kc,a.Pn,"oj.CollectionPagingDataSource");a.Kc.prototype.Init=function(){a.Kc.N.Init.call(this)};a.f.j("CollectionPagingDataSource.prototype.Init",{Init:a.Kc.prototype.Init});a.Kc.prototype.r3=function(){return this.Tl()?this.Mu:this.totalSize()-this.current};
a.Kc.prototype.JA=function(){this.fk=Array(this.r3());var a=this;return this.yb.zC(this.current,this.current+this.fk.length).then(function(c){for(var e=0;e<c.length;e++)a.fk[e]=c[e];a.gL();a.dn=a.oa+a.fk.length-1})};a.Kc.prototype.gL=function(){if(void 0!==this.Bq){this.Bq.removeAll();for(var b=0;b<this.fk.length;b++)this.Bq.push(a.Hb.map(this.fk[b]))}};a.Kc.prototype.$u=function(){return this.fk};a.f.j("CollectionPagingDataSource.prototype.getWindow",{$u:a.Kc.prototype.$u});a.Kc.prototype.KM=function(){void 0===
this.Bq&&(this.Bq=c.observableArray(),this.gL());return this.Bq};a.f.j("CollectionPagingDataSource.prototype.getWindowObservable",{KM:a.Kc.prototype.KM});a.Kc.prototype.getPage=function(){return this.bf};a.f.j("CollectionPagingDataSource.prototype.getPage",{getPage:a.Kc.prototype.getPage});a.Kc.prototype.setPage=function(b,c){c=c||{};b=parseInt(b,10);try{a.Kc.N.handleEvent.call(this,a.bi.ga.BEFOREPAGE,{page:b,previousPage:this.bf})}catch(e){return Promise.reject(null)}this.pageSize=null!=c.pageSize?
c.pageSize:this.pageSize;c.startIndex=b*this.pageSize;var f=this.bf;this.bf=b;this.oa=c.startIndex;var g=this;return new Promise(function(b,e){g.ki(c).then(function(){a.Kc.N.handleEvent.call(g,a.bi.ga.PAGE,{page:g.bf,previousPage:f});b(null)},function(){g.bf=f;g.oa=g.bf*g.pageSize;e(null)})})};a.f.j("CollectionPagingDataSource.prototype.setPage",{setPage:a.Kc.prototype.setPage});a.Kc.prototype.getStartItemIndex=function(){return this.oa};a.f.j("CollectionPagingDataSource.prototype.getStartItemIndex",
{getStartItemIndex:a.Kc.prototype.getStartItemIndex});a.Kc.prototype.getEndItemIndex=function(){return this.dn};a.f.j("CollectionPagingDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.Kc.prototype.getEndItemIndex});a.Kc.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.pageSize)};a.f.j("CollectionPagingDataSource.prototype.getPageCount",{getPageCount:a.Kc.prototype.getPageCount});a.Kc.prototype.fetch=function(a){var c=a||{};if(void 0!==c.pageSize&&void 0!==
c.startIndex){if(!this.Tl())return this.wT(null),Promise.resolve();this.Mu=c.startIndex+c.pageSize;var e=this;return this.JA().then(function(){e.wT(null)})}return this.ki(a)};a.f.j("CollectionPagingDataSource.prototype.fetch",{fetch:a.Kc.prototype.fetch});a.Kc.prototype.ki=function(a){var c=a||{};void 0!==c.startIndex&&(this.current=c.startIndex);void 0!==c.pageSize&&(this.Mu=this.pageSize=c.pageSize);var e=this;return new Promise(function(a){try{e.yb.fetch({success:function(){e.JA().then(function(){e.wT(c);
a({data:e.$u(),startIndex:e.current})})}})}catch(b){e.JA().then(function(){e.wT(c);a({data:e.$u(),startIndex:e.current})})}})};a.Kc.prototype.wT=function(a){a=a||{};a.silent||this.handleEvent("sync",{data:this.$u(),startIndex:this.current});a.success&&a.success()};a.Kc.prototype.handleEvent=function(b,c){return a.Kc.N.handleEvent.call(this,b,c)};a.Kc.prototype.Tl=function(){return this.current+this.Mu<this.totalSize()};a.Kc.prototype.U6=function(a){this.Mu=this.pageSize=a};a.Kc.prototype.size=function(){var a=
this.$u();return a?a.length:0};a.f.j("CollectionPagingDataSource.prototype.size",{size:a.Kc.prototype.size});a.Kc.prototype.totalSize=function(){return this.yb.length};a.f.j("CollectionPagingDataSource.prototype.totalSize",{totalSize:a.Kc.prototype.totalSize});a.Kc.prototype.totalSizeConfidence=function(){return"actual"};a.f.j("CollectionPagingDataSource.prototype.totalSizeConfidence",{totalSizeConfidence:a.Kc.prototype.totalSizeConfidence});a.Kc.prototype.getCapability=function(){return null};a.f.j("CollectionPagingDataSource.prototype.getCapability",
{getCapability:a.Kc.prototype.getCapability})});