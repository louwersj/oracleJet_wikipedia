/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","knockout","ojs/ojeventtarget","ojs/ojdataprovider"],function(a,g,c){g=function(){function b(a,b){this.data=a;this.options=b;this.Wi="key";this.Oc="keys";this.ZY="afterKeys";this.TC="direction";this.PC="attribute";this.EP="sort";this.nf="sortCriteria";this.hc="data";this.vf="metadata";this.Sv="indexes";this.ei="offset";this.hi="size";this.Zda="idAttribute";this.JDa="implicitSort";this.EFa="sortComparators";this.NCa="comparators";this.Xm="results";this.Qm="fetchParameters";
this.FH="containsParameters";this.Gj="value";this.Pm="done";this.YY="add";this.e_="remove";this.D_="update";this.ct=function(){return function(a,b,c){this.lc=a;this.metadata=b;this.data=c;this[a.vf]=b;this[a.hc]=c}}();this.Hk=function(){return function(a,b){this.lc=a;this.key=b;this[a.Wi]=b}}();this.sC=function(){return function(a,b,c){this.lc=a;this.fetchParameters=b;this.results=c;this[a.Qm]=b;this[a.Xm]=c}}();this.XG=function(){return function(a,b,c){this.lc=a;this.containsParameters=b;this.results=
c;this[a.FH]=b;this[a.Xm]=c}}();this.fY=function(){return function(a,b,c,d){this.lc=a;this.fetchParameters=b;this.results=c;this.done=d;this[a.Qm]=b;this[a.Xm]=c;this[a.Pm]=d}}();this.tC=function(){return function(a,b,c){this.lc=a;this.size=b;this.sortCriteria=c;this[a.hi]=b;this[a.nf]=c}}();this.Bv=function(){return function(a,b,c,d){this.lc=a;this.fetchParameters=b;this.data=c;this.metadata=d;this[a.Qm]=b;this[a.hc]=c;this[a.vf]=d}}();this.jC=function(){return function(a,b){this.lc=a;this.zp=b;
this[Symbol.asyncIterator]=function(){return this.zp}}}();this.kC=function(){function a(b,c,d,e){this.lc=b;this.PK=c;this.RK=d;this.C0=e}a.prototype.next=function(){var a=this.PK(this.RK,this.C0);this.C0+=a.value[this.lc.hc].length;return Promise.resolve(a)};return a}();this.xv=function(){return function(a,b,c){this.lc=a;this.value=b;this.done=c;this[a.Gj]=b;this[a.Pm]=c}}();this.yC=function(){return function(a,b,c,d){this.lc=a;this.add=b;this.remove=c;this.update=d;this[a.YY]=b;this[a.e_]=c;this[a.D_]=
d}}();this.uO=function(){return function(a,b,c,d,e){this.lc=a;this.keys=b;this.metadata=c;this.data=d;this.indexes=e;this[a.Oc]=b;this[a.vf]=c;this[a.hc]=d;this[a.Sv]=e}}();this.yY=function(){return function(a,b,c,d,e,g){this.lc=a;this.keys=b;this.metadata=d;this.data=e;this.indexes=g;this[a.Oc]=b;this[a.ZY]=c;this[a.vf]=d;this[a.hc]=e;this[a.Sv]=g}}();this.wra=0;this.vU(a);null!=b&&null!=b[this.Oc]&&(this.Kg=b[this.Oc])}b.prototype.containsKeys=function(a){var b=this;return this.fetchByKeys(a).then(function(c){var h=
new Set;a[b.Oc].forEach(function(a){null!=c[b.Xm].get(a)&&h.add(a)});return Promise.resolve(new b.XG(b,a,h))})};b.prototype.fetchByKeys=function(a){var b=this;this.kR();var c=new Map;a[this.Oc].forEach(function(a){var d=b.Cw().indexOf(a);0<=d&&c.set(a,new b.ct(b,new b.Hk(b,a),b.fE()[d]))});return Promise.resolve(new this.sC(this,a,c))};b.prototype.fetchByOffset=function(a){var b=this,c=null!=a?a[this.hi]:-1,h=null!=a?a[this.nf]:null,k=null!=a?0<a[this.ei]?a[this.ei]:0:0;this.kR();var c=new this.tC(this,
c,h),c=this.Bja(c,k),k=c[this.Gj],c=c[this.Pm],h=k[this.hc],g=k[this.vf].map(function(a){return a[b.Wi]}),k=h.map(function(a,c){return new b.ct(b,new b.Hk(b,g[c]),a)});return Promise.resolve(new this.fY(this,a,k,c))};b.prototype.fetchFirst=function(a){return new this.jC(this,new this.kC(this,this.Bja.bind(this),a,0))};b.prototype.getCapability=function(a){return"sort"==a||null==a?{V_a:"sort",attributes:"multiple",type:"naturalSort"}:null};b.prototype.getTotalSize=function(){return Promise.resolve(this.fE().length)};
b.prototype.fE=function(){return this[this.hc]instanceof Array?this[this.hc]:this[this.hc]()};b.prototype.Cw=function(){return null==this.Kg||this.Kg instanceof Array?this.Kg:this.Kg()};b.prototype.vU=function(b){if(!(b instanceof Array)){if(!this.BSa(b))throw Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");var c=this;b.subscribe(function(b){var d,k,g=[],m=[],p=[];d=[];var t=[],s=!1,n=k=!1;for(d=0;d<b.length;d++)if("deleted"===b[d].status){s=!0;break}for(d=0;d<
b.length;d++)if("added"===b[d].status){k=!0;break}k&&s&&(n=!0);if(s){for(d=0;d<b.length;d++)"deleted"===b[d].status&&(m.push(c.Cw()[b[d].index]),g.push(b[d].value),p.push(b[d].index));0<m.length&&m.map(function(a){a=c.Cw().indexOf(a);c.Kg.splice(a,1)});if(0<m.length&&!n){d=m.map(function(a){return new c.Hk(c,a)});var q=new Set;m.map(function(a){q.add(a)});d=new c.uO(c,q,d,g,p);d=new c.yC(c,null,d,null);c.dispatchEvent(new a.kH(d))}}if(k){for(d=0;d<b.length;d++)"added"===b[d].status&&(c.kR(),k=c.Wt(b[d].value),
null==k&&(k=c.Cw()[b[d].index]),null==k&&(k=c.wra++,c.Kg.splice(b[d].index,0,k)),-1==c.Cw().indexOf(k)&&c.Kg.splice(b[d].index,0,k),m.push(k),k=c.Cw()[b[d].index+1],k=null==k?"":k,t.push(k),g.push(b[d].value),p.push(b[d].index));if(0<m.length&&!n){d=m.map(function(a){return new c.Hk(c,a)});var r=new Set;m.map(function(a){r.add(a)});var u=new Set;t.map(function(a){u.add(a)});d=new c.yY(c,r,u,d,g,p);d=new c.yC(c,d,null,null);c.dispatchEvent(new a.kH(d))}n&&c.dispatchEvent(new a.pC)}},null,"arrayChange")}};
b.prototype.BSa=function(a){return c.isObservable(a)&&void 0!==a.destroyAll};b.prototype.kR=function(){if(null==this.Kg){var a=null!=this.options?this.options[this.Zda]:null;this.Kg=[];for(var b=this.fE(),c=void 0,h=0,h=0;h<b.length;h++){c=this.Wt(b[h]);if(null==c||"@index"==a)c=this.wra++;this.Kg[h]=c}}};b.prototype.Wt=function(a){var b,c=null!=this.options?this.options[this.Zda]:null;if(null!=c){if(Array.isArray(c)){var h;b=[];for(h=0;h<c.length;h++)b[h]=this.D3(a,c[h])}else b="@value"==c?this.wMa(a):
this.D3(a,c);return b}return null};b.prototype.D3=function(a,b){return"function"==typeof a[b]?a[b]():a[b]};b.prototype.wMa=function(a){var b=this;return Object.keys(a).map(function(c){return b.D3(a,c)})};b.prototype.Bja=function(a,b){var c=this;this.kR();var h=null!=a?a[this.nf]:null,k=this.FMa(h),g=k.map(function(a){return c.fE()[a]}),m=k.map(function(a){return c.Cw()[a]}),p=null!=a?0<a[this.hi]?a[this.hi]:0>a[this.hi]?c.Cw().length:25:25,k=g.slice(b,b+p),m=m.slice(b,b+p).map(function(a){return new c.Hk(c,
a)}),g=b+p<g.length?!0:!1,h=this.zTa(h);null!=h&&(a=a||{},a[this.nf]=h);h=new this.Bv(this,a,k,m);return new this.xv(this,h,!g)};b.prototype.FMa=function(a){var b=this.fE().map(function(a,b){return b});return this.HYa(b,a)};b.prototype.HYa=function(a,b){var c=this,h=a.map(function(a){return{index:a,value:c.fE()[a]}});null!=b&&h.sort(this.tOa(b));return h.map(function(a){return a.index})};b.prototype.tOa=function(a){var b=this;return function(c,h){var k=null!=b.options?b.options[b.EFa]:null,g,m,p,
t;for(g=0;g<a.length;g++)if(m=a[g][b.TC],p=a[g][b.PC],t=null,null!=k&&(t=k[b.NCa].get(p)),null!=t){if(m="descending"==m?-1:1,m*=t(c.value[p],h.value[p]),0!=m)return m}else if(t=0,t="string"===typeof c.value[p]?c.value[p]:new String(c.value[p]),p="string"===typeof h.value[p]?h.value[p]:new String(h.value[p]),t="ascending"==m?t.localeCompare(p,void 0,{numeric:!0,sensitivity:"base"}):p.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"}),0!=t)return t;return 0}};b.prototype.zTa=function(a){var b=
null!=this.options?this.options[this.JDa]:null;if(null!=b){if(null==a)return b;a=a.slice(0);for(var c=void 0,h=void 0,k=void 0,c=0;c<b.length;c++){k=!1;for(h=0;h<a.length;h++)a[h][this.PC]==b[c][this.PC]&&(k=!0);k||a.push(b[c])}}return a};return b}();a.ArrayDataProvider=g;a.dY.t8(g);a.f.j("ArrayDataProvider.prototype.containsKeys",{containsKeys:g.prototype.containsKeys});a.f.j("ArrayDataProvider.prototype.fetchByKeys",{fetchByKeys:g.prototype.fetchByKeys});a.f.j("ArrayDataProvider.prototype.fetchByOffset",
{fetchByOffset:g.prototype.fetchByOffset});a.f.j("ArrayDataProvider.prototype.fetchFirst",{fetchFirst:g.prototype.fetchFirst});a.f.j("ArrayDataProvider.prototype.getCapability",{getCapability:g.prototype.getCapability});a.f.j("ArrayDataProvider.prototype.getTotalSize",{getTotalSize:g.prototype.getTotalSize})});