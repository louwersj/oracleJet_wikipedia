/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojarraytabledatasource","ojs/ojcolor","ojs/ojlistview","ojs/ojeditablevalue"],function(a,g){(function(){a.hb("oj.ojColorPalette",g.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{labelledBy:null,palette:null,swatchSize:"lg",labelDisplay:"off",layout:"grid",value:null},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=a.subId,d=a.index;a=this._super(a);if(!a)switch(b){case "oj-palette-entry":b=
this.ie.find(".oj-listview-item"),b.length&&d<b.length&&(a=b[d])}return a},getSubIdByNode:function(a){var b=g(a),d=null,e=-1,f=null,h;b.is("li")&&b.hasClass("oj-listview-item-element")&&(d="oj-palette-entry",h=b.attr("id"),b=this.ie.find(".oj-listview-item"),g.each(b,function(a,b){if(g(b).attr("id")===h)return e=a,!1}));d&&(f={subId:d},0<=e&&(f.index=e));null==f&&(f=this._super(a));return f},add:function(c){var b=null,d;c instanceof a.o?b={color:c}:"object"===typeof c&&(d=c.color,d instanceof a.o&&
(b=c));b&&(this.jU("The swatch add is being animated in the palette (id\x3d"+this.element.attr("id")+")."),b.id=this.rla(),this.nn||(this.nn=[]),this.nn.push({tg:"a",$W:b}),this.FE.add(b),this.j8())},remove:function(c){var b=null,d;d=typeof c;"number"===d?0<=c&&c<this.Uj.length?b=this.Uj[c].id:a.D.error("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Invalid index for remove ("+c+")"):"object"===d&&(c=c instanceof a.o?c:c.color,b=this.eMa(c));b&&(c={id:b},this.jU("The removed swatch is being animated in the palette (id\x3d"+
this.element.attr("id")+")."),this.nn||(this.nn=[]),this.nn.push({tg:"r",$W:c}),this.FE.remove(c),this.j8())},whenReady:function(){var a=this;return new Promise(function(b){a.ie.ojListView("whenReady").then(function(){b(!0)})})},_destroy:function(){this.w6();this.ie&&(this.nn=[],this.ie.ojListView("destroy"));this.FE=null;this.Zca.remove();this.zh.removeClass("oj-colorpalette");this.Kz();this._super()},qc:function(){this._super();this.HRa()},Kf:function(){var c;this._super();this.bk(null,this.options.labelledBy,
this.ie);this.Y()||(c=this.iz());c?(c=c.attr("id"))?this.ie.attr("aria-labelledby",c):a.D.warn("JET Color Palette: The label for this component needs an id in order to be accessible"):(c=this.element.attr("aria-label"))&&this.ie.attr("aria-label",c)},_setOption:function(a,b,d){var e=this.options.labelledBy;switch(a){case "value":this.S6(b);break;case "palette":this.UXa(b);break;case "swatchSize":this.VXa(b);break;case "layout":this.TXa(b);break;case "labelDisplay":this.SXa(b);break;case "disabled":this.AL(b,
!0);break;case "labelledBy":this.bk(e,b,this.ie)}this._super(a,b,d)},bk:a.ia.bk,iUa:function(a,b){"selection"===b.option&&this.hXa(a,b)},j8:function(){if(!this.GZ){var c=this;this.GZ=a.Context.getContext(this.ie[0]).Rc();this.GZ.whenReady().then(function(){c.GZ=null;var a,d,e,f,g;c.w6();if(c.nn){e=!1;for(g=0;g<c.nn.length;g++)if(a=c.nn[g],d=a.$W,"a"===a.tg||"r"===a.tg)e=!0,f||(f=c.Uj.slice(0)),"a"===a.tg?f.push(d):"r"===a.tg&&(d=c.dMa(f,d.id),f.splice(d,1),a.index=d);if(e)for(c.Vz("palette",f,null);c.nn.length;)a=
c.nn.shift(),d=a.$W,"a"===a.tg?c.Uj.push(d):"r"===a.tg&&c.Uj.splice(a.index,1)}},function(){a.D.error("JET Color Palette (id\x3d'"+c.element.attr("id")+"'): ListView timed out.");c.nn=[]})}},xQ:function(c,b){var d=b instanceof a.o,e=!1;c instanceof a.o&&d&&(e=c.isEqual(b));return e},Vz:function(a,b,d){"palette"===a&&this.option(a,b,{_context:{originalEvent:d,mb:!0},changed:!0})},Z1:function(a){var b=-1,d=this.Uj,e=d.length,f,g;for(f=0;f<e;f++)if(g=d[f],a.isEqual(g.color)){b=f;break}return b},eMa:function(a){var b=
null,d=this.Uj,e=d.length,f,g;for(f=0;f<e;f++)if(g=d[f],a.isEqual(g.color)){b=g.id;break}return b},dMa:function(a,b){var d=-1,e=a.length,f,g;for(f=0;f<e;f++)if(g=a[f],g.id===b){d=f;break}return d},jU:function(c){this.UT||(this.UT=a.Context.getContext(this.element[0]).Rc().Vc({description:c}))},w6:function(){this.UT&&(this.UT(),this.UT=null)},BWa:function(c){var b,d,e,f,g,k;b=c.data.color;b instanceof a.o||(b=a.o.BLACK,a.D.warn("JET Color Palette (id\x3d'"+this.element.attr("id")+"'): Substituting oj.Color.BLACK for an object that is not an instance of oj.Color"));
d=e=c.data.label;f="auto"===this.bT&&"list"===this.jg&&"sm"===this.eF||"auto"===this.bT&&"grid"===this.jg&&"lg"===this.eF;null!=b&&(k=d?d:this.a1.format(b),f?(d=k?k:this.a1.format(b),d=e?d:d.toUpperCase()):d=null,g=!!(this.MSa(b)||d&&"none"===d.toLowerCase()));e="";this.kn===c.data.id&&(e="oj-selected",this.kn=-1,this.G6=c.parentElement);c="list"===this.jg?"oj-colorpalette-swatchsize-"+this.eF+(g?" oj-colorpalette-swatch-none":""):this.Qsa+(g?" oj-colorpalette-swatch-none":"");return g?this.xWa(f,
d,k,c,e):this.zWa(b,f,d,k,c,e)},zWa:function(a,b,d,e,f,h){a="\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+f+(b?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+h+"' style\x3d'background-color:"+a.toString()+"'"+(d?"":" title\x3d'"+e+"'")+"\x3e\x3c/div\x3e\x3c/div\x3e";d&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+d+"\x3c/span\x3e");return g(a+"\x3c/div\x3e")[0]},xWa:function(a,b,d,e,f){a=
"\x3cdiv class\x3d'oj-colorpalette-swatch-entry "+e+(a?" oj-colorpalette-swatch-showlabel":"")+"'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-container'\x3e\x3cdiv class\x3d'oj-colorpalette-swatch "+f+"'"+(b?"":" title\x3d'"+d+"'")+"\x3e\x3cdiv class\x3d'oj-colorpalette-swatch-none-icon'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";b&&(a+="\x3cspan class\x3d'oj-colorpalette-swatch-text'\x3e"+b+"\x3c/span\x3e");return g(a+"\x3c/div\x3e")[0]},hXa:function(a,b){var d=null,e,f;e=g(b.items[0]).find(".oj-colorpalette-swatch");
e.addClass("oj-selected");f=this.jXa;this.jXa=e;!f&&this.G6&&(f=g(this.G6).find(".oj-colorpalette-swatch"),this.G6=null);f&&f.removeClass("oj-selected");if(1===b.value.length){for(e=0;e<this.Uj.length;e++)if(this.Uj[e].id===b.value[0]){d=this.Uj[e].color;break}this.ic(d,a);this.Vf=d}},AL:function(a,b){var d,e;if(!b||b&&a!==this.vr)this.ie&&this.ie.ojListView("option","disabled",a),d=g(".oj-colorpalette-container .oj-colorpalette-swatch"),e=this,a?(this.fJ=[],g.each(d,function(a,b){e.fJ.push(b.style.backgroundColor);
b.style.backgroundColor="#eee"})):(this.fJ&&this.fJ.length&&g.each(d,function(a,b){b.style.backgroundColor=e.fJ[a]}),this.fJ=null),this.vr=a},S6:function(c){var b=-1,d=[];0<this.Uj.length&&c instanceof a.o&&!this.xQ(this.Vf,c)&&(b=this.Z1(c),0<=b&&d.push(b),this.ie.ojListView("option","selection",d),this.Vf=c);return 0<=b},UXa:function(a){g.isArray(a)&&!this.ESa(a,this.Uj)&&(this.jU("The palette (id\x3d"+this.element.attr("id")+") option change in progress."),this.nn=[],this.Uj=a.slice(0),this.kn=
this.Z1(this.Vf),this.Jra(a,this.kn,!0),this.j8())},VXa:function(a){"string"===typeof a&&a!==this.eF&&(this.eF=a,this.Qsa="oj-colorpalette-swatchsize-"+("lg"===a?"lg":"sm"===a?"sm":"xs"),this.ie.ojListView("refresh"))},SXa:function(a){"string"!==typeof a||a===this.bT||"auto"!==a&&"off"!==a||(this.bT=a,this.ie.ojListView("refresh"))},TXa:function(a){"string"===typeof a&&a!==this.jg&&(this.jg=a,this.rXa(),this.ie.ojListView("refresh"))},rXa:function(){var a="grid"===this.jg,b=a?"oj-colorpalette-grid":
"oj-colorpalette-list";this.ie.removeClass("oj-colorpalette-grid oj-colorpalette-list oj-listview-card-layout");this.ie.addClass(b);a&&this.ie.addClass("oj-listview-card-layout")},Jra:function(c,b,d){this.QGa(c);this.FE=new a.gb(c,{idAttribute:"id"});0<=b&&(this.Uj[b].id&&(b=this.Uj[b].id),0===this.rT.length?this.rT.push(b):this.rT[0]=b);d&&this.ie.ojListView("option","data",this.FE)},HRa:function(){this.jU("Palette (id\x3d"+this.element.attr("id")+") is initializing.");this.eK();this.qb()},qb:function(){this.zh.append(this.CK);
this.zh.addClass("oj-colorpalette");this.Zca=this.zh.find(".oj-colorpalette-container");this.ie=this.Zca.find(":first");this.ie.attr("data-oj-context","");this.Vf&&this.Vf instanceof a.o&&(this.kn=this.Z1(this.Vf));this.Rsa=0;this.Jra(this.Uj,this.kn,!1);this.ie.ojListView({data:this.FE,item:{renderer:this.BWa.bind(this)},optionChange:this.iUa.bind(this),selectionMode:"single",selection:this.rT,rootAttributes:{style:"height:100%;width:100%"}}).attr("data-oj-internal","");var c=this;a.Context.getContext(this.ie[0]).Rc().whenReady().then(function(){c.ie.ojListView("option",
"translations.msgNoData","");c.AL(c.vr);if(c.ie[0].scrollWidth>c.ie[0].clientWidth){var a=c.nOa(),d="rtl"===c.Uc();c.ie.css(d?"padding-left":"padding-right",a+1)}c.w6()})},eK:function(){this.a0();this.Vha=a.Na.bl(a.Yh.CONVERTER_TYPE_COLOR);this.a1=this.Vha.createConverter({format:"hex"});this.R("labelNone");this.CK=["\x3cdiv class\x3d'oj-colorpalette-container'\x3e","\x3cul class\x3d'"+("grid"===this.jg?"oj-colorpalette-grid oj-listview-card-layout":"oj-colorpalette-list")+"'/\x3e","\x3c/div\x3e"].join("")},
a0:function(){var c=this.options,b;this.zh=g(this.element);this.vr=!1;this.rT=[];this.FE=null;b=c.swatchSize;"string"===typeof b&&(b=b.toLowerCase(),"lg"!==b&&"sm"!==b&&"xs"!==b&&(b="lg"));this.eF=b;this.Qsa="oj-colorpalette-swatchsize-"+b;b=c.labelDisplay;"string"===typeof b&&(b=b.toLowerCase(),"auto"!==b&&"off"!==b&&(b="auto"));this.bT=b;b=c.layout;"string"===typeof b&&(b=b.toLowerCase(),"grid"!==b&&"list"!==b&&(b="grid"),"grid"!==b&&"xs"===this.eF&&(b="grid"));this.jg=b;b=c.value;b instanceof a.o||
(b=null);this.Vf=b?b:a.o.BLACK;b=c.palette;g.isArray(b)||(b=[]);this.Uj=b.slice(0);b=c.disabled;"boolean"===typeof b&&(this.vr=b)},MSa:function(a){var b=a.SF(),d=a.JF(),e=a.GF();a=a.FF();return 0===b&&0===d&&0===e&&0===a},ESa:function(a,b){var d=a.length,e=b.length,f,g;f=!1;if(d===e){for(e=0;e<d&&(f=a[e],g=b[e],!this.xQ(f.color,g.color)||(f=f.label,g=g.label,f===g));e++);f=e>=d}return f},QGa:function(a){var b,d,e=a.length;for(b=0;b<e;b++)d=a[b],d.id=this.rla()},rla:function(){var a=this.Rsa.toString();
this.Rsa++;return a},Kz:function(){this.Vha=this.a1=this.CK=this.ie=null},nOa:function(){var a=g("\x3cdiv style\x3d'overflow: scroll; width: 100px; height: 100px; position: absolute; visibility: hidden;'\x3e\x3cdiv style\x3d'width: 100%; height: 100%;'\x3e\x3c/div\x3e\x3c/div\x3e");this.element.append(a);var b=a[0].offsetWidth,d=a.children()[0].offsetWidth;a.remove();return b-d},_GetMessagingLauncherElement:function(){return this.element},ze:function(){return this.ie},Rv:function(){return this.Vf},
Pk:function(c){this.Vf="string"===typeof c?new a.o(c):c},Ui:function(){return this.Vf.toString()},_GetDefaultStyleClass:function(){return"oj-colorpalette"}})})();a.J.Ua("oj-color-palette","editableValue",{properties:{labelDisplay:{type:"string",enumValues:["auto","off"]},labelledBy:{type:"string"},layout:{type:"string",enumValues:["grid","list"]},palette:{type:"Array"},swatchSize:{type:"string",enumValues:["lg","sm","xs"]},value:{writeback:!0}},extension:{Xa:"ojColorPalette"}});a.J.register("oj-color-palette",
{metadata:a.J.getMetadata("oj-color-palette")})});