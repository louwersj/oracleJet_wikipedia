/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojanimation","ojs/ojkeyset","ojdnd"],function(a,g){(function(){a.hb("oj.ojTreeView",g.oj.baseComponent,{version:"1.0.0",defaultElement:"\x3cdiv\x3e",widgetEventPrefix:"oj",options:{currentItem:null,data:null,dnd:{drag:null,drop:null},expanded:new a.yba,item:{focusable:null,renderer:null,selectable:null},selection:[],selectionMode:"none",animateEnd:null,animateStart:null,beforeCollapse:null,beforeCurrentItem:null,beforeExpand:null,collapse:null,
expand:null},qc:function(){this._super()},Kf:function(){this._super();this.IRa();this.Gqa()},IRa:function(){var a=this;this._on(this.element,{click:function(b){a.O3(b)},mouseover:function(b){a.c4(b)},mouseout:function(b){a.lS(b)},mousedown:function(b){a.a4(b)},mouseup:function(b){a.d4(b)},keydown:function(b){a.Hr(b)},dragstart:function(b){a.VJ(b)},drag:function(b){a.zma(b,"drag")},dragend:function(b){a.zma(b,"dragEnd")},dragenter:function(b){a.hS(b,"dragEnter")},dragover:function(b){a.hS(b,"dragOver")},
dragleave:function(b){a.hS(b,"dragLeave")},drop:function(b){a.hS(b,"drop")}});var b=g(document.createElement("span")).addClass("oj-treeview-drop-marker-icon oj-component-icon");this.XQ=g(document.createElement("div")).addClass("oj-treeview-drop-marker").append(b).appendTo(this.element);this.lja=this.XQ[0].getBoundingClientRect();this.XQ.hide();this.hJ=g(document.createElement("div")).addClass("oj-treeview-drop-line").appendTo(this.element);this.CLa=this.hJ[0].getBoundingClientRect();this.hJ.hide()},
Gqa:function(){var a=this;this.element.removeClass("oj-complete");this.options.data?(this.element.find("ul").remove(),this.zja(null,function(b){a.Iqa(b,a.element);a.r6();a.element.addClass("oj-complete")})):(this.element.find("ul").addClass("oj-treeview-list").attr("role","group"),this.element.find("li").each(function(){var b=g(this);a.xia(b)}),this.r6(),this.element.addClass("oj-complete"));this.EKa();this.yK=null},zja:function(c,b){var d=this.options.data,e={start:0,count:d.getChildCount(c)},f=
this.Bg("fetching data");d.fetchChildren(c,e,{success:function(a){b(a);f()},error:function(b){a.D.error(b);f()}})},Iqa:function(a,b){for(var d=g(document.createElement("ul")).addClass("oj-treeview-list").attr("role","group").appendTo(b),e=0;e<a.getCount();e++)this.wWa(d,a,e)},wWa:function(c,b,d){d+=b.getStart();var e=b.getData(d);b=b.getMetadata(d);var f=b.key,h=this.options.item.renderer,h=this.Fl(h),k=g(document.createElement("li")).attr("id",f).appendTo(c);if(h){var l={};l.parentElement=k;l.index=
d;l.data=e;l.datasource=this.options.data;l.parentKey=this.nb(this.OR(k));l.component=a.Components.wd(this.element);this.Nk&&(l=this.Nk(l));for(var m in b)b.hasOwnProperty(m)&&(l[m]=b[m]);m=h.call(this,l);null!=m&&(null===m.parentNode||m.parentNode instanceof DocumentFragment?k.append(m):null==m.parentNode&&m.toString&&(h=document.createElement("span"),h.appendChild(document.createTextNode(m.toString())),k.append(h)));k=c.children().eq(d);l.parentElement=k;null==k.attr("id")&&k.attr("id",f)}k.data("data",
e).data("metadata",b);this.xia(k)},EKa:function(){var a=this,b=this.Kla();this._focusable({element:b,applyHighlight:!0,setupHandlers:function(b,d){a.Oj=b;a.bj=d}});b.attr("tabIndex",0).on("focus",function(){a.Oj(a.Bw(a.lw))}).on("blur",function(){a.bj(a.Bw(a.lw))}).attr("role","tree").attr("aria-labelledby",this.element.attr("id"));var d=this.options.selectionMode;"none"!=d?b.attr("aria-multiselectable","multiple"==d?"true":"false"):b.removeAttr("aria-multiselectable")},xia:function(a){a.addClass("oj-treeview-item").attr("role",
"treeitem");var b=this.Bw(a);0==b.length&&(b=g(document.createElement("div")).addClass("oj-treeview-item-content").append(a.children(":not(ul)")).prependTo(a),b.find(".oj-treeview-item-icon").addClass("oj-treeview-icon"));this.vi(a);var d=this.Aw();b.attr("draggable",0<Object.keys(d).length?"true":"false");b=a.children(".oj-treeview-spacer");0==b.length&&(b=g(document.createElement("ins")).addClass("oj-treeview-icon oj-treeview-spacer").prependTo(a));this.Ao(a)?a.addClass("oj-treeview-leaf"):(this.foa(a)?
this.qe(a,!1):this.ii(a,!1),b.addClass("oj-treeview-disclosure-icon oj-component-icon oj-clickable-icon-nocontext oj-default"))},Ol:function(){return this.element.find(".oj-treeview-item")},nb:function(a){var b=a.data("metadata");return b?b.key:a.attr("id")},N2:function(a){return this.element.find("li#"+a)},Bw:function(a){return a.children(".oj-treeview-item-content")},hka:function(a){return a.children(".oj-treeview-list").children(".oj-treeview-item")},OR:function(a){return a.parent(".oj-treeview-list").parent(".oj-treeview-item")},
SJ:function(a){return a.children(".oj-treeview-list")},Kla:function(){return this.element.children(".oj-treeview-list")},Ao:function(a){var b=a.data("metadata");return!(b?!b.leaf:0<this.SJ(a).length)},foa:function(a){a=this.nb(a);var b=this.options.expanded;return b&&b.has?b.has(a):!1},Vl:function(a){return a.hasClass("oj-expanded")},qe:function(a,b,d,e){var f=this;if(!(this.Vl(a)||this.Ao(a)||b&&!this._trigger("beforeExpand",d,this.GJ(a))&&!1!==e)){if(0==this.SJ(a).length)return f.zja(f.nb(a),function(e){f.Iqa(e,
a);f.rja(a,b,d)});f.rja(a,b,d);this.yK=null}},rja:function(a,b,d){var e=this;a.removeClass("oj-collapsed").addClass("oj-expanded").attr("aria-expanded","true");var f=this.SJ(a);f.css("max-height","none");if(b){var g=this.Bg("animating expand");a.addClass("oj-treeview-animated");this.ZE(f,"expand").then(function(){a.removeClass("oj-treeview-animated");e._trigger("expand",d,e.GJ(a));var b=e.options.expanded.add([e.nb(a)]);e.sF("expanded",b,d);g()})}},ii:function(a,b,d,e){var f=this;if(!(a.hasClass("oj-collapsed")||
this.Ao(a)||b&&!this._trigger("beforeCollapse",d,this.GJ(a))&&!1!==e)){a.removeClass("oj-expanded").addClass("oj-collapsed").attr("aria-expanded","false");var g=this.SJ(a);if(b){var k=this.Bg("animating collapse");a.addClass("oj-treeview-animated");this.ZE(g,"collapse").then(function(){g.css("max-height",0);a.removeClass("oj-treeview-animated");f._trigger("collapse",d,f.GJ(a));var b=f.options.expanded["delete"]([f.nb(a)]);f.sF("expanded",b,d);k()})}else g.css("max-height",0);this.yK=null}},ZE:function(c,
b){this.gq||(this.gq=a.gc.Yc("oj-treeview-option-defaults"));return a.ea.Fi(c[0],b,(this.gq.animation||{})[b],this)},GJ:function(a){return{key:this.nb(a),item:a[0]}},JS:function(a,b){var d=this.options.item[b+"able"];if(!1===d)return!1;if("function"===typeof d){var e=this.getContextByNode(a[0]);return d(e)}return!0},qi:function(a){a=this.nb(a);return-1!=this.options.selection.indexOf(a)},vi:function(c,b){var d=this.options.selectionMode;if("none"!=d&&this.JS(c,"select")){var e=this.qi(c);if(b){var f=
a.T.ke(),g=a.T.Bs(b),k="multiple"==d,l=40==b.keyCode||38==b.keyCode,d=this.nb(c),m=[];if(k&&b.shiftKey&&!l){g?m=this.options.selection.slice(0):this.Qk();for(f=(e=this.yK)&&e.offset().top<c.offset().top?this.f3.bind(this):this.l3.bind(this);e&&e[0]!=c[0];)g=this.nb(e),-1==m.indexOf(g)&&(m.push(g),this.kU(e)),e=f(e,"select");e=!0;m.push(d)}else k&&(g||f||l)?(e=!e,m=this.options.selection.slice(0),e?m.push(d):m.splice(m.indexOf(d),1)):(this.Qk(),(f||32==b.keyCode)&&e?(e=!1,m=[]):(e=!0,m=[d]));this.sF("selection",
m,b);this.yK=c}e?this.kU(c):this.ksa(c)}},kU:function(a){this.Bw(a).addClass("oj-selected");a.attr("aria-selected","true")},ksa:function(a){this.Bw(a).removeClass("oj-selected");a.attr("aria-selected","false")},Qk:function(){this.ksa(this.Ol())},gh:function(a,b){if(this.JS(a,"focus")){if(b){var d=this.GJ(a);this.lw&&(d.previousKey=this.nb(this.lw),d.previousItem=this.lw[0]);if(!this._trigger("beforeCurrentItem",b,d))return;this.sF("currentItem",this.nb(a),b)}this.bj(this.Bw(this.lw));this.Oj(this.Bw(a));
this.N6(a)}},r6:function(){if(this.options.currentItem){var a=this.N2(this.options.currentItem);if(0<a.length){this.N6(a);return}}a=this.Ol().first();this.N6(a);this.sF("currentItem",this.nb(this.lw),null)},N6:function(a){this.lw=a;this.Kla().attr("aria-activedescendant",this.nb(a))},Bg:function(c){var b=a.Context.getContext(this.element[0]).Rc(),d=this.element.attr("id");return b.Vc({description:"The component identified by '"+d+"', "+c})},sF:function(a,b,d){this.option(a,b,{_context:{originalEvent:d,
ld:!0,mb:!0}})},Aw:function(){return((this.options.dnd||{}).drag||{}).items||{}},tR:function(){return((this.options.dnd||{}).drop||{}).items||{}},pR:function(a){return g(a.target).closest(".oj-treeview-item-content")},xJ:function(a){return g(a.target).closest(".oj-treeview-disclosure-icon")},O3:function(a){var b=this.xJ(a);0<b.length?(b=b.closest(".oj-treeview-item"),this.Vl(b)?this.ii(b,!0,a):this.qe(b,!0,a)):(b=this.pR(a),0<b.length?(b=b.parent(),this.vi(b,a),this.gh(b,a)):(this.Qk(),this.yK=null,
this.sF("selection",[],a)))},c4:function(c){if(!a.T.ke()){var b=this.xJ(c);0==b.length&&(b=this.pR(c));b.removeClass("oj-default");b.addClass("oj-hover")}},lS:function(c){if(!a.T.ke()){var b=this.xJ(c);b.removeClass("oj-selected");0==b.length&&(b=this.pR(c));b.addClass("oj-default");b.removeClass("oj-hover")}},a4:function(a){this.xJ(a).addClass("oj-selected")},d4:function(a){this.xJ(a).removeClass("oj-selected")},Hr:function(a){var b=a.keyCode,d=this.lw;if(38==b||40==b){if(b=40==b?this.f3(d,"focus"):
this.l3(d,"focus"))a.preventDefault(),this.qi(d)&&a.shiftKey&&this.vi(this.qi(b)?d:b,a),this.gh(b,a)}else if(37==b||39==b){var e="rtl"==this.Uc(),b=!e&&39==b||e&&37==b;if(!b||this.Ao(d)||this.Vl(d))if(b||this.Ao(d)||!this.Vl(d)){if(b=b?this.f3(d,"focus"):this.l3(d,"focus"))a.preventDefault(),this.gh(b,a)}else a.preventDefault(),this.ii(d,!0,a);else a.preventDefault(),this.qe(d,!0,a)}else if(13==b||32==b)a.preventDefault(),this.vi(d,a)},NNa:function(a){if(!this.Ao(a)&&this.Vl(a)){var b=this.hka(a).first();
if(0<b.length)return b}for(;0<a.length;){b=a.next(".oj-treeview-item");if(0<b.length)return b;a=this.OR(a)}return null},f3:function(a,b){for(;null!=a;)if(a=this.NNa(a),this.JS(a,b))return a;return null},eOa:function(a){for(var b=a.prev(".oj-treeview-item");0<b.length;)if(!this.Ao(b)&&this.Vl(b)){var d=this.hka(b).last();if(0<d.length)b=d;else return b}else return b;a=this.OR(a);return 0<a.length?a:null},l3:function(a,b){for(;null!=a;)if(a=this.eOa(a),this.JS(a,b))return a;return null},VJ:function(a){var b=
this,d="rtl"==this.Uc(),e=this.pR(a).parent();if(0!=e.length){var f=g();if(this.qi(e))for(var h=this.options.selection,e=0;e<h.length;e++)f=f.add(this.N2(h[e]));else this.vi(e,a),f=f.add(e);var h=this.Aw(),k=a.originalEvent.dataTransfer,l=[],m=g(document.createElement("ul")).addClass("oj-treeview-drag-image oj-treeview-list"),p=Infinity,t=Infinity;f.each(function(){var a=g(this);l.push(a.data("data"));var c=a.offset();d&&(c.left=b.Bw(a).offset().left);a=a.clone().css({top:c.top,left:c.left});b.SJ(a).remove();
c.top<p&&(p=c.top);c.left<t&&(t=c.left);m.append(a)});m.children().each(function(){g(this).css({top:parseFloat(g(this).css("top"))-p,left:parseFloat(g(this).css("left"))-t})});f=h.dataTypes||[];for(e=0;e<f.length;e++)k.setData(f[e],JSON.stringify(l));g("body").append(m);k.setDragImage(m[0],a.pageX-t,a.pageY-p);setTimeout(function(){m.remove()},0);(f=h.dragStart)&&f(a.originalEvent,{items:l})}},zma:function(a,b){var d=this.Aw()[b];d&&d(a.originalEvent)},hS:function(a,b){var d=this.tR(),e=d.dataTypes||
[],f=d[b],h=g(a.target).closest(".oj-treeview-item"),k=h.children(".oj-treeview-spacer")[0].getBoundingClientRect(),l=(k.top+k.bottom)/2,d="inside",m=a.pageY-k.top;m<.25*k.height?d="before":m>.75*k.height&&(d=this.Vl(h)?"first":"after");f&&f(a.originalEvent,{item:h[0],position:d});for(f=0;f<e.length;f++)if((h=a.originalEvent.dataTransfer.types)&&0<=h.indexOf(e[f])){a.preventDefault();break}if("dragEnter"!=b&&"dragOver"!=b||!a.originalEvent.defaultPrevented)this.XQ.hide(),this.hJ.hide();else{h="rtl"==
this.Uc();e=l;f=h?k.left-this.CLa.width:k.right;l-=this.lja.height/2;m=k.left+k.width/2-this.lja.width/2;if("before"==d)l-=k.height/2,e-=k.height/2;else if("after"==d||"first"==d)l+=k.height/2,e+=k.height/2,"first"==d&&(k=(h?-1:1)*k.width,m+=k,f+=k);this.XQ.css("top",l+"px").css("left",m+"px").show();"inside"!=d?this.hJ.css("top",e+"px").css("left",f+"px").show():this.hJ.hide()}},refresh:function(){this._super();this.Gqa()},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:
null;var b=a.subId;a=this.N2(a.key);var d;"oj-treeview-disclosure"===b?d=a.children(".oj-treeview-disclosure-icon")[0]:"oj-treeview-item"===b&&(d=a[0]);return d||null},getSubIdByNode:function(a){if(!g.contains(this.element[0],a))return null;var b=g(a);if(b.hasClass("oj-treeview-disclosure-icon"))b=b.parent(),a="oj-treeview-disclosure";else if(b.hasClass("oj-treeview-item"))a="oj-treeview-item";else return null;return{subId:a,key:this.nb(b)}},getContextByNode:function(c){if(!g.contains(this.element[0],
c))return null;c=g(c);if(!c.hasClass("oj-treeview-item"))return null;var b={subId:"oj-treeview-item"};b.index=c.parent().children(".oj-treeview-item").index(c);b.parentKey=this.nb(this.OR(c));b.component=a.Components.wd(this.element);this.Nk&&(b=this.Nk(b));var d=c.data("metadata");if(d){b.data=c.data("data");b.datasource=this.options.data;for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}else b.key=this.nb(c),b.leaf=this.Ao(c),b.depth=c.parents(".oj-treeview-list").length;return b},_setOption:function(a,
b,d){var e=this;this._superApply(arguments);"expanded"==a?this.Ol().each(function(){var a=g(this);e.foa(a)?e.qe(a,!0):e.ii(a,!0)}):"selection"==a?this.Ol().each(function(){var a=g(this);e.vi(a)}):"currentItem"==a?this.r6():this.refresh()},_destroy:function(){this._super()}})})();a.J.Ua("oj-tree-view","baseComponent",{properties:{currentItem:{type:"any",readOnly:!0,writeback:!0},data:{},dnd:{type:"object",properties:{drag:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array\x3cstring\x3e"},
drag:{},dragEnd:{},dragStart:{}}}}},drop:{type:"object",properties:{items:{type:"object",properties:{dataTypes:{type:"Array\x3cstring\x3e"},dragEnter:{},dragLeave:{},dragOver:{},drop:{}}}}}}},expanded:{writeback:!0},item:{type:"object",properties:{focusable:{},renderer:{},selectable:{}}},selection:{type:"Array\x3cobject\x3e",writeback:!0},selectionMode:{type:"string",enumValues:["none","single","multiple"]}},events:{animateEnd:{},animateStart:{},beforeCollapse:{},beforeCurrentItem:{},beforeExpand:{},
collapse:{},expand:{}},methods:{getContextByNode:{}},extension:{Xa:"ojTreeView"}});a.J.register("oj-tree-view",{metadata:a.J.getMetadata("oj-tree-view")})});