/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojcolor","ojs/ojslider","jqueryui-amd/widgets/draggable","ojs/ojtouchproxy","ojs/ojeditablevalue"],function(a,g){(function(){function c(a){var c;c=a.SF();var e=a.JF(),f=a.GF();c/=255;var e=e/255,f=f/255,g=Math.max(c,e,f),k=Math.min(c,e,f),l,m=(g+k)/2;if(g==k)l=k=0;else{var p=g-k,k=.5<m?p/(2-g-k):p/(g+k);switch(g){case c:l=(e-f)/p+(e<f?6:0);break;case e:l=(f-c)/p+2;break;case f:l=(c-e)/p+4}l/=6}c=[l,k,m];c[0]*=360;c[1]*=100;c[2]*=100;c.push(a.FF());
return c}a.hb("oj.ojColorSpectrum",g.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{labelledBy:null,value:null,rawValue:null},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var c=a.subId;a=this._super(a);if(!a)switch(c){case "oj-spectrum":a=this.Vn[0];break;case "oj-spectrum-thumb":a=this.Ve[0];break;case "oj-hue-slider-bar":a=this.Lm.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-hue-slider-bar-value":a=this.Lm.ojSlider("getNodeBySubId",
{subId:"oj-slider-bar-value"});break;case "oj-hue-slider-thumb":a=this.Lm.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"});break;case "oj-opacity-slider-bar":a=this.Km.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-opacity-slider-bar-value":a=this.Km.ojSlider("getNodeBySubId",{subId:"oj-slider-bar-value"});break;case "oj-opacity-slider-thumb":a=this.Km.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"})}return a},getSubIdByNode:function(a){if(!a)return null;var c=g(a),
e=null,f;c.hasClass("oj-colorspectrum-spectrum")?e="oj-spectrum":c.hasClass("oj-colorspectrum-thumb")?e="oj-spectrum-thumb":(f=c.closest(".oj-slider"),f=f.hasClass("oj-slider-vertical")?"hue":"opacity",c.hasClass("oj-slider-bar")?e="oj-"+f+"-slider-bar":c.hasClass("oj-slider-bar-value")?e="oj-"+f+"-slider-bar-value":c.hasClass("oj-slider-thumb")&&(e="oj-"+f+"-slider-thumb"));return null!=e?{subId:e}:this._super(a)},_destroy:function(){this.zh&&(this.OIa(),this.OKa(),this.bWa(),this.zh.removeClass("oj-colorspectrum"),
this.Kz());this._super()},qc:function(){this._super();this.ARa()},Kf:function(){var b;this._super();this.bk(null,this.options.labelledBy,this.Ve);this.Y()||(b=this.iz());b?(b=b.attr("id"))?this.Ve.attr("aria-labelledby",b):a.D.warn("JET Color Spectrum: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.Ve.attr("aria-label",b)},_setOption:function(a,c,e){var f=this.options.labelledBy;switch(a){case "value":this.S6(c);break;case "disabled":this.AL(c,
!0);break;case "labelledBy":this.bk(f,c,this.Ve)}this._super(a,c,e)},Ym:function(b,c){if("string"===typeof b)try{b=new a.o(b)}catch(e){a.D("ojColorSpectrum (id\x3d'"+this.element.attr("id")+"'): invalid rawValue ("+b+"), defaulting to black"),b=a.o.BLACK}var f={};f._context={originalEvent:c,ld:!0,mb:!0,readOnly:!0};this.nJa(this.options.rawValue,b)||this.option("rawValue",b,f)},bk:a.ia.bk,nJa:function(a,c){return a.SF()===c.SF()&&a.JF()===c.JF()&&a.GF()===c.GF()&&a.FF()===c.FF()},xQ:function(b,c){var e=
c instanceof a.o;return b instanceof a.o&&e&&b.isEqual(c)},AL:function(a,c){var e=!c||c&&a!==this.vr;e&&(this.GLa(!a),a?(this.element.addClass("oj-disabled"),this.Ooa(!1)):(this.element.removeClass("oj-disabled"),this.Ooa(!0)),this.vr=a);return e},S6:function(b){b instanceof a.o&&!this.xQ(this.Vf,b)&&(this.Fra(b),this.hsa(this.Jr,!0),this.hsa(this.xp,!1),this.W6(this.Jr,this.RE,this.xE,this.xp,!0))},tpa:function(b,c){var e,f,h,k,l;if(this.Esa&&("rawValue"==c.option||"value"==c.option)&&void 0!==c.value&&
("value"==c.option&&(this.koa=!!b.originalEvent),f=g(b.target),e=f.hasClass("oj-colorspectrum-hue"),f=f.hasClass("oj-colorspectrum-alpha"),e||f)){f=this.Jr;h=this.RE;k=this.xE;l=this.xp;e?(f=c.value,this.GU(f,h,k),this.W6(f,h,k,l,!1)):(l=c.value,this.tL(f,h,k,l));e=new a.o({h:f,s:h,l:k,a:l});if(b.originalEvent||this.koa)this.koa=!1,"rawValue"===c.option?this.Ym(e,b):"value"===c.option&&this.ic(e,b);this.Fra(e)}},hsa:function(a,c){(c?this.Lm:this.Km).ojSlider("option","value",a)},W6:function(a,c,e,
f,g){this.Vn.css("background-color","hsl("+a+", 100%, 50%)");g&&(g=this.lOa(c,e),this.UE(g.x,g.y));this.tL(a,c,e,f)},eYa:function(){var b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)";switch(a.Va.Ho().browser){case a.Va.Ak.dO:b="moz";break;default:b="webkit";break;case a.Va.Ak.iH:b="ms"}b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)".replace(/___/g,
b);this.Vn.css("backgroundImage",b)},UE:function(a,c){isNaN(a)||(this.yx=a);isNaN(c)||(this.zx=c);this.Zoa(0,0)},lOa:function(a,c){var e=Math.min(a/100*this.zu,this.zu),f=this.Zp-Math.min(c/100*this.Zp,this.Zp);return{x:Math.round(e),y:Math.round(f)}},Zoa:function(a,c){var e,f;e=this.yx+a;f=this.zx+c;0>e&&(e=0);0>f&&(f=0);e>=this.zu&&(e=this.zu-1);f>=this.Zp&&(f=this.Zp-1);this.yx=e;this.zx=f;e=e-this.Yl+"px";f=f-this.Yl+"px";this.Ve[0].style.left=e;this.Ve[0].style.top=f},JYa:function(b){if(!this.vr){var c=
this.Vn.offset(),e=b.pageX-c.left,c=b.pageY-c.top,f,g,k,e=Math.round(e),c=Math.round(c);f=this.m3(e,c);g=f.nX;k=f.n$;f=this.Jr;this.GU(f,g,k);var l=new a.o({h:f,s:g,l:k,a:this.xp});this.Ym(l,b);this.ic(l,b);this.tL(f,g,k,this.xp);this.Vf=l;this.fsa(g,k);this.UE(e,c);this.Ve.focus()}},TSa:function(a){var c,e,f,g=1;this.Aoa=(new Date).getTime();0>this.Vw&&(this.Vw=this.Aoa,this.zoa=0);c=this.Aoa-this.Vw;this.zoa++;if(1400<c||25<this.zoa)g=3;e=f=0;c=a.keyCode;if(40==c)f=g;else if(38==c)f=-g;else if(39==
c)e=g;else if(37==c)e=-g;else if(36==c)this.UE(0,0),this.Vw=-1;else if(35==c)this.UE(this.zu-1,this.Zp-1),this.Vw=-1;else if(33==c)this.UE(NaN,0),this.Vw=-1;else if(34==c)this.UE(NaN,this.Zp-1),this.Vw=-1;else return;this.Zoa(e,f);this.Rma(a,this.yx,this.zx);a.preventDefault();return!1},VSa:function(a){this.Vw=-1;var c=this.m3(this.yx,this.zx);this.tL(this.Jr,c.nX,c.n$,this.xp);this.ic(this.options.rawValue,a)},LRa:function(){this.Vn[0].getBoundingClientRect();this.y7||(this.y7=this.aZa.bind(this));
this.Ve.draggable({drag:this.y7,stop:this.y7})},Ooa:function(a){this.Ve.draggable(a?"enable":"disable")},aZa:function(a,c){var e,f,g,k;c.position.left<-this.Yl?(c.position.left=-this.Yl,e=0):c.position.left+this.Yl>=this.zu&&(c.position.left=this.zu-1-this.Yl,f=this.zu-1);c.position.top<-this.Yl?(c.position.top=-this.Yl,f=0):c.position.top+this.Yl>=this.Zp&&(c.position.top=this.Zp-1-this.Yl,f=this.Zp-1);g=this.Ve.offset();k=this.Vn.offset();0!=e&&(e=g.left+this.Yl-k.left);0!=f&&(f=g.top+this.Yl-k.top);
if(this.yx!==e||this.zx!==f)"drag"===a.type?(this.yx=e,this.zx=f):(e=this.yx,f=this.zx),this.Rma(a,e,f)},Rma:function(b,c,e){var f,g,k=!1;f=this.Jr;e=this.m3(c,e);c=e.nX;e=e.n$;this.GU(f,c,e);g=new a.o({h:f,s:c,l:e,a:this.xp});this.Ym(g,b);"dragstop"===b.type&&(this.ic(g,b.originalEvent),k=!0);this.Vf=g;this.fsa(c,e);k&&this.tL(f,c,e,this.xp)},m3:function(a,c){return{nX:a/(this.zu-1)*100,n$:100-c/(this.Zp-1)*100}},GU:function(a,c,e){var f="hsla("+a+","+c+"%,"+e+"%, 0)";c="hsla("+a+","+c+"%,"+e+"%, 1.0)";
this.sE&&(a=c,c=f,f=a);this.D1=a="linear-gradient(90deg, "+f+", "+c+"),"+this.T_;this.yH.css("background",a)},iOa:function(a,c,e,f){var g="number"===typeof f&&1>f;a=Math.round(a);c=Math.round(100*c)/100;e=Math.round(100*e)/100;return a="hsl"+(g?"a(":"(")+(a+", "+c+"%, "+e+"%"+(g?","+f:"")+")")},fsa:function(a,c){this.RE=a;this.xE=c},Fra:function(a){a&&(this.Vf=a,a=c(a),this.Jr=a[0],this.RE=a[1],this.xE=a[2],this.xp=a[3])},tL:function(a,c,e,f){this.Ve.attr("aria-valuetext",this.iOa(a,c,e,f))},ARa:function(){this.eK();
this.qb()},qb:function(){this.zh.append(this.CK);this.zh.addClass("oj-colorspectrum");g(".oj-colorspectrum-hue").uniqueId();g(".oj-colorspectrum-alpha").uniqueId();this.zh.find(".oj-colorspectrum-container");this.Lm=this.zh.find(".oj-colorspectrum-hue");this.Km=this.zh.find(".oj-colorspectrum-alpha");this.Vn=this.zh.find(".oj-colorspectrum-spectrum");this.Ve=this.zh.find(".oj-colorspectrum-thumb");this.Yl=this.Ve[0].offsetWidth/2;0>=this.Yl&&(this.Yl=this.Ve.width()/2);this.sA=a.T.ke();this.zu=this.Vn.width();
this.Zp=this.Vn.height();this.Ve.attr("aria-describedby",this.zh.find(".oj-colorspectrum-thumb-description").uniqueId().attr("id"));this.T_="url('"+a.ra.Bb("common/images/spectrum-opacity-slider-bg.png")+"')";this.T_=this.T_.replace("js","css");var b=this.vr?!0:!1,d=c(this.Vf);this.Jr=d[0];this.RE=d[1];this.xE=d[2];this.xp=d[3];this.Esa=!1;this.Lm.ojSlider({max:360,min:0,step:1,value:this.Jr,orientation:"vertical",optionChange:this.tpa.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal",
"");this.Km.ojSlider({max:1,min:0,step:.01,value:this.xp,orientation:"horizontal",optionChange:this.tpa.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal","");this.JRa();this.eYa();this.W6(this.Jr,this.RE,this.xE,this.xp,!0);this.Vn.click(this.JYa.bind(this));this.LRa();this.AL(b);this.Ve.keydown(this.TSa.bind(this));this.Ve.keyup(this.VSa.bind(this));this.Vn.focus(this.$Ta.bind(this));this._focusable({element:this.Ve,z8a:!0});a.T.ke()&&this.d7(this.Ve)},$Ta:function(){this.Ve.focus();
return!1},JRa:function(){var a={subId:"oj-slider-bar"};this.zH=g(this.Lm.ojSlider("getNodeBySubId",a));this.yH=g(this.Km.ojSlider("getNodeBySubId",a));a.n9a="oj-slider-bar-value";g(this.Lm.ojSlider("getNodeBySubId",a));g(this.Km.ojSlider("getNodeBySubId",a));this.zH.css("background","linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)");this.F1="linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)";
this.GU(this.Jr,this.RE,this.xE);this.Esa=!0},eK:function(){this.a0();this.zx=this.yx=0;var a=this.Ag(this.R("labelHue")),c=this.Ag(this.R("labelOpacity"));this.CK=["\x3cdiv class\x3d'oj-colorspectrum-container'\x3e\x3cdiv class\x3d'oj-colorspectrum-spectrum' tabindex\x3d'-1' style\x3d'position:relative'\x3e\x3cdiv class\x3d'oj-colorspectrum-thumb' role\x3d'slider' aria-describedby\x3d'' style\x3d'position:absolute;top:-9999px;left:-9999px;' tabIndex\x3d'0'\x3e\x3c/div\x3e\x3c/div\x3e","\x3cdiv class\x3d'oj-colorspectrum-thumb-description oj-helper-hidden-accessible'\x3e"+
this.Ag(this.R("labelThumbDesc"))+"\x3c/div\x3e","\x3cinput class\x3d'oj-colorspectrum-hue' aria-label\x3d'"+a+"'\x3e\x3c/input\x3e","\x3cinput class\x3d'oj-colorspectrum-alpha' aria-label\x3d'"+c+"'\x3e\x3c/input\x3e","\x3c/div\x3e"].join("");this.Vw=-1;this.sE="rtl"===this.Uc()},a0:function(){var b=this.options,c;this.zh=g(this.element);this.vr=!1;c=b.value;c instanceof a.o||(c=null);this.Vf=c?c:a.o.BLACK;b.rawValue=this.Vf;c=b.disabled;this.vr="boolean"===typeof c?c:!1},GLa:function(a){var c=!a;
a?(this.Lm.ojSlider("option","disabled",c),this.Km.ojSlider("option","disabled",c),c={subId:"oj-slider-bar"},this.Lm=this.zh.find(".oj-colorspectrum-hue"),this.Km=this.zh.find(".oj-colorspectrum-alpha"),this.zH=g(this.Lm.ojSlider("getNodeBySubId",c)),this.yH=g(this.Km.ojSlider("getNodeBySubId",c)),this.D1&&this.yH.css("background",this.D1),this.F1&&this.zH.css("background",this.F1)):((a=this.zH.css("background"))&&0<a.length&&(this.F1=a),(a=this.yH.css("background"))&&0<a.length&&(this.D1=a),this.zH.css("background",
""),this.yH.css("background",""),this.Lm.ojSlider("option","disabled",c),this.Km.ojSlider("option","disabled",c))},OKa:function(){this.Lm.ojSlider("destroy");this.Km.ojSlider("destroy")},bWa:function(){this.zh.empty()},OIa:function(){this.Vn.off("click");this.Ve.off("mousedown");this.Ve.off("keydown");this.Ve.off("keyup");this.RL&&this.v7(this.Ve)},Kz:function(){this.CK=this.zh=this.Lm=this.Km=this.Vn=this.Ve=null},d7:function(b){this.RL=a.dh.p8(b)},v7:function(b){a.dh.naa(b)},_GetMessagingLauncherElement:function(){return this.element},
ze:function(){return this.Ve},Rv:function(){return this.Vf},Pk:function(b){this.Vf="string"===typeof b?new a.o(b):b},Ui:function(){return this.Vf.toString()},_GetDefaultStyleClass:function(){return"oj-colorspectrum"},Ag:function(a){return g("\x3cspan\x3e"+a+"\x3c/span\x3e").text()}})})();a.J.Ua("oj-color-spectrum","editableValue",{properties:{labelledBy:{type:"string"},value:{writeback:!0}},methods:{},extension:{Xa:"ojColorSpectrum"}});a.J.register("oj-color-spectrum",{metadata:a.J.getMetadata("oj-color-spectrum")})});